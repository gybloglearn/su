<md-progress-linear md-mode="indeterminate" ng-show="vm.loading"></md-progress-linear>
<md-content layout="row" layout-sm="column" layout-xs="column">
  <div layout-padding flex>
    <h1 class="md-display-2" layout="row">
      <span flex>Összesítő</span>
      <md-button class="md-fab md-primary md-hue-2">
        <md-icon class="material-icons">dashboard</md-icon>
      </md-button>
    </h1>
    <md-divider>
      <div layout-gt-xs="row">
        <div flex-gt-xs>
          <md-input-container>
            <md-datepicker ng-model="vm.startdate" md-max-date="vm.maxdate"></md-datepicker>
          </md-input-container>
          <md-input-container>
            <md-datepicker ng-model="vm.enddate" md-max-date="vm.maxdate"></md-datepicker>
          </md-input-container>
          <md-button class="md-primary md-raised" ng-click="vm.load()" ng-disabled="vm.loading">Betöltés</md-button>
        </div>
      </div>
      <div layout="row">
        <div flex="10">Nap</div>
        <div flex="10">Szak</div>
        <div flex="10">SM</div>
        <div flex="10">Típus</div>
        <div flex="10">Össz</div>
        <div flex="10">Jó</div>
        <div flex="10">Jó AEQ</div>
        <div flex="10">Jó Modul</div>
        <div flex="10">Átadott lap</div>
        <div flex="10">Selejt lap</div>
      </div>
      <div class="pivot" ng-repeat="date in vm.sm | unique: 'date' | orderBy:'date' track by $index">
        <div layout="row" class="row hover" ng-click="showshifts=!showshifts">
          <div flex="40">
            <h3>{{date.date}}</h3>
          </div>
          <div flex="10">{{vm.sm | filter:{date: date.date} | sumField: 'ttlamount' | number:0}}</div>
          <div flex="10">{{vm.sm | filter:{date: date.date} | sumField: 'amount' | number:0}}</div>
          <div flex="10">{{vm.sm | filter:{date: date.date} | sumField: 'sumaeq' | number:2}}</div>
          <div flex="10">{{vm.sm | filter:{date: date.date} | sumField: 'modul' | number:0}}</div>
          <div flex="10">{{vm.sm | filter:{date: date.date} | sumField: 'lsh' | number:0}}</div>
          <div flex="10" ng-class="{'text-ge-red':(vm.sm | filter:{date: date.date} | sumField: 'bad') != (vm.sm | filter:{date: date.date} | sumField: 'diff')}">{{vm.sm | filter:{date: date.date} | sumField: 'bad' | number:0}}</div>
        </div>
        <div ng-repeat="sh in [1,3]" ng-show="showshifts">
          <div layout="row" class="row hover" ng-click="showsms=!showsms">
            <div flex="10"></div>
            <div flex="30">
              <h4>{{sh==1?'DE':'DU'}} - {{sh | shift:date.date}}</h4>
            </div>
            <div flex="10">{{vm.sm | filter:{date: date.date, shiftnum: sh} | sumField: 'ttlamount' | number:0}}</div>
            <div flex="10">{{vm.sm | filter:{date: date.date, shiftnum: sh} | sumField: 'amount' | number:0}}</div>
            <div flex="10">{{vm.sm | filter:{date: date.date, shiftnum: sh} | sumField: 'sumaeq' | number:2}}</div>
            <div flex="10">{{vm.sm | filter:{date: date.date, shiftnum: sh} | sumField: 'modul' | number:0}}</div>
            <div flex="10">{{vm.sm | filter:{date: date.date, shiftnum: sh} | sumField: 'lsh' | number:0}}</div>
            <div flex="10" ng-class="{'text-ge-red':(vm.sm | filter:{date: date.date, shiftnum:sh} | sumField: 'bad') != (vm.sm | filter:{date: date.date, shiftnum:sh} | sumField: 'diff')}">{{vm.sm | filter:{date: date.date, shiftnum: sh} | sumField: 'bad' | number:0}}</div>
          </div>
          <div ng-repeat="item in ((vm.sm | filter: {date:date.date, shiftnum:sh}) | unique:'id') | orderBy:'id'" ng-show="showsms">
            <div layout="row" class="row hover" ng-click="showtypes=!showtypes">
              <div flex="20"></div>
              <div flex="10">
                <h5>{{item.id}}</h5>
              </div>
              <div flex="10">
                <span ng-if="(vm.sm | filter: {date:date.date, shiftnum:sh, id:item.id}).length == 1">{{item.type}}</span>
              </div>
              <div flex="10">{{vm.sm | filter:{id: item.id, date: date.date, shiftnum: sh} | sumField: 'ttlamount' | number:0}}</div>
              <div flex="10">{{vm.sm | filter:{id: item.id, date: date.date, shiftnum: sh} | sumField: 'amount' | number:0}}</div>
              <div flex="10">{{vm.sm | filter:{id: item.id, date: date.date, shiftnum: sh} | sumField: 'sumaeq' | number:2}}</div>
              <div flex="10">{{vm.sm | filter:{id: item.id, date: date.date, shiftnum: sh} | sumField: 'modul' | number:0}}</div>
              <div flex="10">{{vm.sm | filter:{id: item.id, date: date.date, shiftnum: sh} | sumField: 'lsh' | number:0}}</div>
              <div flex="10" ng-class="{'text-ge-red':(vm.sm | filter:{date: date.date,id:item.id, shiftnum:sh, type:it.type} | sumField: 'bad') != (vm.sm | filter:{date: date.date,id:item.id, shiftnum:sh, type:it.type} | sumField: 'diff')}">{{vm.sm | filter:{id: item.id, date: date.date, shiftnum: sh} | sumField: 'bad' | number:0}}</div>
            </div>
            <div layout="row" class="row hover" ng-if="(vm.sm | filter: {date:date.date, shiftnum:sh, id:item.id}).length > 1" class="row"
              ng-repeat="it in vm.sm | filter: {date: date.date, shiftnum:sh, id: item.id} | orderBy: 'type'" ng-show="showtypes">
              <div flex=20></div>
              <div flex=10>{{it.type}}</div>
              <div flex="10">{{vm.sm | filter:{id: item.id, date: date.date, shiftnum: sh, type: it.type} | sumField: 'ttlamount' | number:0}}</div>
              <div flex="10">{{vm.sm | filter:{id: item.id, date: date.date, shiftnum: sh, type: it.type} | sumField: 'amount' | number:0}}</div>
              <div flex="10">{{vm.sm | filter:{id: item.id, date: date.date, shiftnum: sh, type: it.type} | sumField: 'sumaeq' | number:2}}</div>
              <div flex="10">{{vm.sm | filter:{id: item.id, date: date.date, shiftnum: sh, type: it.type} | sumField: 'modul' | number:0}}</div>
              <div flex="10">{{vm.sm | filter:{id: item.id, date: date.date, shiftnum: sh, type: it.type} | sumField: 'lsh' | number:0}}</div>
              <div flex="10" ng-class="{'text-ge-red':(vm.sm | filter:{date: date.date,id:item.id, shiftnum:sh, type:it.type} | sumField: 'bad') != (vm.sm | filter:{date: date.date,id:item.id, shiftnum:sh, type:it.type} | sumField: 'diff')}">{{vm.sm | filter:{id: item.id, date: date.date, shiftnum: sh, type: it.type} | sumField: 'bad' | number:0}}</div>
            </div>
          </div>
        </div>
      </div>
    </md-divider>
  </div>
</md-content>